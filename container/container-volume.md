[TOP](../README.md)   
前: [コンテナへのアクセス](./container-access.md)  
次: [コンテナに環境変数を設定](./container-env.md)  

---

# コンテナにファイルシステムをマウント

コンテナ内のファイルシステムは一時的な領域です。コンテナが無くなるとコンテナ内のファイルシステムに保存したデータも失われてしまいます。これを回避するにはコンテナに外部のボリュームをマウントしデータをその中に保存します。

1. ``centos:8``のイメージを使いコンテナをバックグラウンドで実行してください。なお、centosのイメージはコマンドを指定しないとすぐに停止するので``sh -c "sleep 3600"``などのコマンドを指定して実行してください。

2. 作成したコンテナにログインし、適当な場所にテストファイルを作成してください。

3. コンテナを削除してください。

4. 先ほどの手順と同じく``centos:8``のイメージを使いコンテナをバックグランドで実行してください。

5. 先ほど作成したテストファイルがなくなっていることを確認してください。

6. コンテナを削除してください。

このように、コンテナに変更を加えてもそのコンテナが失われるとデータも一緒に消えてしまいます。（なお、コンテナを``削除``ではなく``停止``すればテスト用のデータは消えませんが、コンテナを停止するという運用はあまり行わず起動/削除が一般的です。）

それでは、コンテナにボリュームをマウントさせてデータを保存してみます。

7. ホストOSに``~/host-dir``というテスト用のディレクトリを作成してください。

8. ``centos:8``のイメージを使いコンテナをバックグラウンドで実行してください。この時、先ほど作成したホストOSのテスト用ディレクトリをコンテナ内の``/container-dir``にマウントしてください。ボリュームマウントは``docker runコマンドのオプション``で指定します。やり方は[日本語マニュアル](http://docs.docker.jp/engine/tutorials/dockervolumes.html#mount-a-host-directory-as-a-data-volume)を参考にしてください。

9.  作成したコンテナにログインし``/container-dir``があることを確認してください。

10. コンテナ内の``/container-dir``配下にテスト用ファイルを作成してください。

11. コンテナを削除してください。

12. 先ほどの手順と同じく``centos:8``のイメージを使いコンテナをバックグラウンドで実行してください。この時、ホストOSのテスト用ディレクトリをコンテナ内の``/container-dir``にマウントしてください。

13. コンテナにログインし/container-dir配下のテスト用ファイルが``あること``を確認してください。

14. ホストOSの``~/host-dir``配下を確認してください。コンテナ内で作成したファイルがあるはずです。

15. ホストOSから``~/host-dir``配下のテストファイルを削除してください。

16. コンテナにログインし、/container-dir配下のテスト用ファイルが``ないこと``を確認してください。

17. 以下コマンドでコンテナをすべて削除してください。
    ``` sh
    docker rm -f `docker ps -a -q`
    ```

18. ホストOSの``~/host-dir``ディレクトリを削除してください。

このように、コンテナにボリュームをマウントさせればデータをコンテナのライフサイクルと切り離すことができます。

---

[TOP](../README.md)   
前: [コンテナへのアクセス](./container-access.md)  
次: [コンテナに環境変数を設定](./container-env.md)  
