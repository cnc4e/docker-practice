[TOP](../README.md)   
前: [コンテナに環境変数を設定](./container-env.md)  
次: [まとめ](./container-summary.md)  

---

# コンテナのログ

コンテナのログはコンテナ実行コマンドの標準出力と標準エラー出力の内容です。

1. ``nginx:1.19.2``のイメージを使いコンテナをバックグラウンドで実行してください。コンテナの80をホストOSの8080に接続してください。

2. ホストOSからコンテナにcurlを実行してください。

3. コンテナのログを表示し、``172.17.0.1``からのアクセスメッセージを確認してください。（ヒント：ログは[docker logs](https://docs.docker.jp/engine/reference/commandline/logs.html)で表示できます。）

このようにコンテナのログを確認できます。このログはjson形式でホストOS内にあります。

4. 以下のコマンドでコンテナログの場所を確認してください。
   ``` sh
   docker inspect {コンテナID} | grep LogPath
   ```

5. ホストOSにあるログファイルの内容を表示してください。jsonに整形されたログが表示されることを確認してください。

6. コンテナを削除してください。

7. さきほど確認したログファイルを確認してください。``ログファイルが存在しないこと``を確認してください。

このように、ログはホストOSでも確認できますが、コンテナが削除されると一緒に消えてしまうので注意してください。また、json形式のログはコンテナが動き続けると無尽蔵に肥大化します。これを防ぐため、ローテート設定（ファイルサイズ、世代数）を指定できます。

8. ``nginx:1.19.2``のイメージを使いコンテナをバックグラウンドで実行してください。コンテナの80をホストOSの8080に接続してください。また、ログの``ファイルサイズを10MB``、``世代数を2``に指定してください。（ヒント：ログの設定は[docker runのオプション](https://docs.docker.jp/engine/admin/logging/overview.html?highlight=%E3%83%AD%E3%82%AE%E3%83%B3%E3%82%B0#json)で指定できます。）

9. 以下コマンドでログ設定を確認してください。
   ``` sh
   docker inspect {コンテナID} | grep -e max-file -e max-size
   ```

10. コンテナを削除してください。

デフォルトでは``json-file``のロギングドライバを使用しています。ロギングドライバを変えることもできます。

11. ``nginx:1.19.2``のイメージを使いコンテナをバックグラウンドで実行してください。コンテナの80をホストOSの8080に接続してください。また、ロギングドライバを``journald``に指定してください。（ヒント：ログの設定は[docker runのオプション](https://docs.docker.jp/engine/admin/logging/overview.html?highlight=%E3%83%AD%E3%82%AE%E3%83%B3%E3%82%B0#id1)で指定できます。）

12. 以下コマンドでコンテナのロギングドライバを確認してください。
   ``` sh
   docker inspect {コンテナID} | grep Type
   ```

13. ホストOSからコンテナにcurlを実行してください。

14. ホストOSで以下のコマンドを実行しジャーナルログを確認してください。
   ``` sh
   journalctl -xe
   ```

15. ホストOSのシステムログを確認してください。

16. 以下コマンドですべてのコンテナを削除してください。
    ``` sh
    docker rm -f `docker ps -a -q`
    ```

今回はコンテナ起動時にロギングドライバの指定や設定をしましたが、デフォルトのロギングドライバを変更することもできます。やり方は[日本語マニュアル](https://docs.docker.jp/config/container/logging/configure.html#configure-the-default-logging-driver)を確認ください。また、ロギングドライバはDockerのエディションにより利用制限があるため注意してください。無料版のCEでは``local``、``json-file``、``journald``の3つが対応しています。

また、``アプリケーションのログはログファイルではなく、標準出力および標準エラー出力に表示``するよう開発してください。そうしないとコンテナ内のログファイルを収集する仕組みなどの実装が必要かもしれません。

---

[TOP](../README.md)   
前: [コンテナに環境変数を設定](./container-env.md)  
次: [まとめ](./container-summary.md)  
